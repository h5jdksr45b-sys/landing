<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Guia Interativo ‚Äì Fam√≠lia e Borderline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #f5f1ea;
      --bg-card: #ffffff;
      --accent: #d77b5b;
      --accent-soft: #f3c2a8;
      --accent-deep: #b35a3a;
      --text-main: #2f2f2f;
      --text-soft: #555555;
      --border-soft: #e3d6c8;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.08);
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --transition-fast: 0.22s ease;
      --font-title: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
      --font-body: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;

      --crisis-bg: #fff2e8;
      --crisis-card: #fff8f3;
      --crisis-accent: #e06a4a;
      --crisis-soft: #f7c3aa;
      --danger: #c0392b;
      --success: #2e7d32;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #fefaf5 0, #f5f1ea 55%, #efe7dd 100%);
      font-family: var(--font-body);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 16px;
    }

    .app-container {
      width: 100%;
      max-width: 980px;
      background: rgba(255,255,255,0.94);
      border-radius: 32px;
      box-shadow: var(--shadow-soft);
      padding: 18px 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.7);
    }

    @media (min-width: 768px) {
      .app-container { padding: 22px 26px 26px; }
    }

    header.app-header { display: flex; flex-direction: column; gap: 10px; }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .title-block { display: flex; flex-direction: column; gap: 4px; }

    .app-eyebrow {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent);
      font-weight: 600;
    }

    .app-title {
      font-family: var(--font-title);
      font-weight: 700;
      font-size: 1.38rem;
      line-height: 1.25;
      margin: 0;
      color: #1f1f1f;
    }

    @media (min-width: 768px) {
      .app-title { font-size: 1.6rem; }
    }

    .subtitle { font-size: 0.9rem; color: var(--text-soft); margin: 0; }

    .doctor-badge {
      padding: 9px 12px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, #f3e0d4, #fdf6ef);
      font-size: 0.78rem;
      color: #4b3426;
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 170px;
    }

    .doctor-name { font-weight: 600; }
    .tagline { font-size: 0.75rem; color: #6b5a4c; }

    .pill-highlight {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(215, 123, 91, 0.08);
      font-size: 0.74rem;
      color: #7a462d;
      font-weight: 500;
      margin-top: 4px;
      align-self: flex-start;
    }

    .status-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent); }

    .top-banner {
      border-radius: 22px;
      padding: 9px 12px 10px;
      background: linear-gradient(135deg, #fdf4ea, #f1e0d2);
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.8rem;
      position: relative;
      overflow: hidden;
    }

    .top-banner::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(215,123,91,0.12) 0, transparent 55%),
        radial-gradient(circle at 100% 0, rgba(174,117,86,0.12) 0, transparent 50%);
      opacity: 0.9;
      pointer-events: none;
    }

    .top-banner-content { position: relative; z-index: 1; }

    .top-banner-title {
      font-weight: 600;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .label-chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #7a5535;
      background: rgba(255,255,255,0.7);
    }

    .top-banner-list { margin: 0; padding-left: 18px; color: var(--text-soft); }
    .top-banner-list li { margin-bottom: 2px; }

    .legal-note { font-size: 0.72rem; color: #856b57; margin-top: 2px; }

    .tabs {
      display: inline-flex;
      align-items: center;
      border-radius: var(--radius-pill);
      padding: 3px;
      background: rgba(0,0,0,0.03);
      margin-top: 6px;
      gap: 3px;
      align-self: flex-start;
    }

    .tab-btn {
      border: none;
      border-radius: var(--radius-pill);
      padding: 6px 13px;
      font-size: 0.8rem;
      cursor: pointer;
      background: transparent;
      color: #6b5a4c;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tab-btn span.icon { font-size: 0.9rem; }

    .tab-btn.active {
      background: #ffffff;
      color: #4b3426;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      transform: translateY(-1px);
    }

    .tab-btn.crisis.active { background: #ffe2ce; color: #7a3623; }

    .app-body { display: flex; flex-direction: column; gap: 12px; }

    .view { display: none; }
    .view.active { display: block; }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 14px;
    }

    @media (min-width: 900px) {
      .layout-main { grid-template-columns: minmax(0, 2.2fr) minmax(260px, 1.4fr); }
    }

    .section-shell {
      background: var(--bg-card);
      border-radius: 24px;
      border: 1px solid var(--border-soft);
      padding: 16px 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .section-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; }

    .section-kicker {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .section-title { font-size: 1rem; font-weight: 600; color: #1f1f1f; margin: 0; }
    .section-subtitle { font-size: 0.86rem; color: var(--text-soft); margin: 0; }

    .badge-compact {
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,0.03);
      color: #6b5a4c;
      border: 1px solid rgba(0,0,0,0.04);
      white-space: nowrap;
    }

    .section-content {
      font-size: 0.86rem;
      color: var(--text-main);
      line-height: 1.55;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    ul.bullet-list { margin: 0; padding-left: 18px; }
    ul.bullet-list li { margin-bottom: 4px; }

    .info-card, .warning-card, .success-card {
      border-radius: 16px;
      padding: 10px 12px;
      font-size: 0.82rem;
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .info-card { background: #f4f6fb; border: 1px solid #d0d7f0; color: #2f3c63; }
    .warning-card { background: #fff7f5; border: 1px solid #f3c0b6; color: #7a3527; }
    .success-card { background: #f1f8f3; border: 1px solid #c5e3cf; color: #235532; }

    .icon-circle {
      width: 22px; height: 22px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center; justify-content: center;
      font-size: 0.9rem;
      flex: 0 0 auto;
    }

    .icon-info { background: #e0e6fa; color: #2f3c63; }
    .icon-warning { background: #fbe2db; color: #a53c2d; }
    .icon-success { background: #d7ecd9; color: #235532; }

    .mini-heading { font-weight: 600; margin-bottom: 2px; }

    .quote-block {
      border-left: 3px solid var(--accent-soft);
      padding-left: 10px;
      margin: 4px 0;
      font-size: 0.84rem;
      color: var(--text-soft);
    }

    .pill-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .pill { font-size: 0.75rem; padding: 6px 10px; border-radius: 999px; background: rgba(0,0,0,0.03); color: #5b4a3b; }

    .section-page { display: none; }
    .section-page.active { display: flex; flex-direction: column; gap: 14px; }

    .side-panel { display: flex; flex-direction: column; gap: 12px; }

    .pill-section-nav {
      border-radius: 18px;
      background: rgba(0,0,0,0.02);
      padding: 10px 10px 8px;
      border: 1px solid rgba(0,0,0,0.03);
    }

    .pill-section-nav-title {
      font-size: 0.78rem;
      font-weight: 600;
      color: #4b3426;
      margin-bottom: 4px;
    }

    .pill-section-nav-items { display: flex; flex-wrap: wrap; gap: 6px; }

    .nav-chip {
      font-size: 0.75rem;
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: #ffffff;
      color: #5b4a3b;
      cursor: pointer;
      transition: background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      white-space: nowrap;
    }

    .nav-chip.active {
      background: #fbe8dd;
      border-color: var(--accent-soft);
      color: #7a462d;
      font-weight: 500;
      transform: translateY(-1px);
    }

    .cta-card {
      border-radius: 20px;
      padding: 12px 12px 13px;
      background: radial-gradient(circle at top left, #f8e0cf 0, #fdf5ee 36%, #ffffff 100%);
      border: 1px solid rgba(215,123,91,0.25);
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.82rem;
      color: #4f3624;
      position: relative;
      overflow: hidden;
    }

    .cta-tag {
      font-size: 0.7rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(0,0,0,0.04);
      align-self: flex-start;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #7a462d;
      font-weight: 600;
    }

    .cta-title { font-weight: 600; font-size: 0.9rem; }
    .cta-note { font-size: 0.72rem; color: #6b5a4c; }

    .ref-card {
      border-radius: 18px;
      background: #faf7f2;
      border: 1px solid #e2d4c4;
      padding: 10px 12px;
      font-size: 0.78rem;
      color: #5b4a3b;
    }

    .ref-card ul { margin: 4px 0 0; padding-left: 18px; }
    .ref-card li { margin-bottom: 2px; }

    .progress-bar-wrapper { display: flex; flex-direction: column; gap: 4px; margin-top: 4px; }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.74rem;
      color: var(--text-soft);
    }

    .progress-track {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(0,0,0,0.05);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--accent), #f3a274);
      transition: width var(--transition-fast);
    }

    .nav-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      gap: 6px;
      flex-wrap: wrap;
    }

    .stepper-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .step-dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(0,0,0,0.15); }
    .step-dot.active { background: var(--accent); }

    .nav-buttons { display: flex; gap: 8px; }

    button.nav-btn {
      border: none;
      border-radius: var(--radius-pill);
      padding: 8px 14px;
      font-size: 0.82rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f0e4d9;
      color: #5b4a3b;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    button.nav-btn.primary {
      background: linear-gradient(135deg, var(--accent), #f3a274);
      color: #fffaf7;
      box-shadow: 0 10px 24px rgba(121,68,45,0.3);
    }

    button.nav-btn:disabled { opacity: 0.35; cursor: default; box-shadow: none; transform: none; }

    button.nav-btn:not(:disabled):active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }

    .nav-caption { font-size: 0.74rem; color: var(--text-soft); }

    .crisis-wrapper {
      background: var(--crisis-bg);
      border-radius: 24px;
      padding: 14px 12px 16px;
      border: 1px solid #f6d1b9;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (min-width: 768px) {
      .crisis-wrapper { padding: 16px 18px 20px; }
    }

    .crisis-header { display: flex; flex-direction: column; gap: 4px; }

    .crisis-kicker {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--crisis-accent);
      font-weight: 600;
    }

    .crisis-title { font-size: 1rem; font-weight: 600; margin: 0; color: #5d2f1f; }
    .crisis-subtitle { font-size: 0.86rem; margin: 0; color: #7c4a32; }

    .crisis-intensity-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 8px;
    }

    @media (min-width: 700px) {
      .crisis-intensity-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .crisis-intensity-card {
      border-radius: 14px;
      padding: 10px 10px;
      background: var(--crisis-card);
      border: 1px solid rgba(0,0,0,0.04);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.82rem;
      color: #5d2f1f;
      transition: border var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast), background var(--transition-fast);
    }

    .crisis-intensity-card:hover { box-shadow: 0 10px 22px rgba(0,0,0,0.08); transform: translateY(-1px); }
    .crisis-intensity-card.active { border-color: var(--crisis-accent); background: #ffe7d8; }

    .crisis-intensity-label {
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .crisis-chip { font-size: 0.7rem; padding: 2px 8px; border-radius: 999px; background: rgba(0,0,0,0.04); }
    .crisis-intensity-desc { font-size: 0.78rem; color: #8b5a3b; }

    .crisis-panel {
      border-radius: 18px;
      background: #fff9f5;
      border: 1px solid #f1c4aa;
      padding: 10px 12px;
      margin-top: 6px;
      font-size: 0.84rem;
      color: #5d2f1f;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .crisis-panel-title {
      font-weight: 600;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .crisis-mode-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--crisis-accent);
    }

    .breathing-container { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 6px; }
    .breathing-circle {
      width: 150px; height: 150px; border-radius: 50%;
      border: 2px solid rgba(0,0,0,0.06);
      background: radial-gradient(circle at 30% 20%, #ffe4d6, #ffccae);
      display: flex; align-items: center; justify-content: center;
      color: #5d2f1f; font-weight: 600; font-size: 0.9rem;
      animation: breathing 8s ease-in-out infinite;
      text-align: center;
      padding: 10px;
    }

    @keyframes breathing {
      0% { transform: scale(0.9); opacity: 0.9; }
      50% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(0.9); opacity: 0.9; }
    }

    .breathing-caption { font-size: 0.78rem; color: #7c4a32; text-align: center; }

    .checklist { display: flex; flex-direction: column; gap: 6px; margin-top: 6px; }
    .checklist-item { display: flex; align-items: flex-start; gap: 8px; font-size: 0.82rem; }
    .checklist-item input { margin-top: 2px; }

    .emergency-box {
      border-radius: 14px;
      padding: 10px 10px;
      background: #fff5f4;
      border: 1px solid #f3b6b0;
      font-size: 0.82rem;
      color: #7a2924;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .emergency-title { font-weight: 600; display: flex; align-items: center; gap: 6px; }
    .emergency-badge { font-size: 0.72rem; padding: 3px 8px; border-radius: 999px; background: #fce3e0; color: #7a2924; }

    .crisis-form {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.8rem;
    }

    .crisis-form label { font-weight: 600; font-size: 0.78rem; }

    .crisis-form textarea,
    .crisis-form select,
    .crisis-form input[type="text"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      padding: 8px 10px;
      font-size: 0.8rem;
      font-family: var(--font-body);
      resize: vertical;
      min-height: 42px;
      background: #fffdf9;
    }

    .crisis-form textarea { min-height: 76px; }

    .crisis-actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
      align-items: center;
      justify-content: flex-start;
    }

    .btn-small {
      border-radius: 999px;
      border: none;
      padding: 7px 12px;
      font-size: 0.78rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f2dfd0;
      color: #5d2f1f;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .btn-small.primary {
      background: #e06a4a;
      color: #fff8f3;
      box-shadow: 0 8px 18px rgba(115,50,29,0.25);
    }

    .btn-small:active { transform: translateY(1px); }
    .crisis-note { font-size: 0.75rem; color: #8b5a3b; margin-top: 2px; }

    .history-box {
      border-radius: 16px;
      background: #fff9f5;
      border: 1px solid #f2d0b8;
      padding: 8px 10px;
      font-size: 0.78rem;
      color: #5d2f1f;
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .history-list { max-height: 150px; overflow-y: auto; padding-right: 4px; }
    .history-entry { border-bottom: 1px solid rgba(0,0,0,0.06); padding: 6px 0; }
    .history-entry:last-child { border-bottom: none; }

    .history-entry-header { display: flex; justify-content: space-between; gap: 6px; font-size: 0.76rem; }
    .history-entry-level { font-weight: 700; text-transform: capitalize; }

    .badge-level-leve { color: #2e7d32; }
    .badge-level-moderada { color: #d68910; }
    .badge-level-grave { color: #c0392b; }

    .history-entry-body { font-size: 0.75rem; color: #7c4a32; margin-top: 2px; }

    .report-output {
      width: 100%;
      min-height: 60px;
      border-radius: 10px;
      border: 1px dashed rgba(0,0,0,0.15);
      padding: 8px 10px;
      font-size: 0.76rem;
      font-family: var(--font-body);
      background: #fffdf9;
      white-space: pre-wrap;
    }

    @media (max-width: 600px) {
      .app-container { border-radius: 24px; }
      .section-title { font-size: 0.94rem; }
      .doctor-badge { min-width: 150px; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <main class="app-container" role="main">
      <header class="app-header">
        <div class="header-row">
          <div class="title-block">
            <div class="app-eyebrow">Mini Manual Interativo</div>
            <h1 class="app-title">
              Como lidar com borderline<br />
              sem piorar as crises
            </h1>
            <p class="subtitle">
              O que fazer, o que evitar e o que dizer quando tudo sai do controle.
            </p>
          </div>
          <aside class="doctor-badge">
            <div class="doctor-name">Dr. Fabio Schmidt</div>
            <div class="tagline">M√©dico ‚Ä¢ CRM/SP 183549</div>
            <div class="pill-highlight">
              <span class="status-dot"></span>
              <span>Material educativo baseado em evid√™ncias</span>
            </div>
          </aside>
        </div>

        <section class="top-banner" aria-label="Aviso importante">
          <div class="top-banner-content">
            <div class="top-banner-title">
              <span>AVISO IMPORTANTE</span>
              <span class="label-chip">Uso educativo</span>
            </div>
            <ul class="top-banner-list">
              <li>Material educativo baseado em evid√™ncias cient√≠ficas.</li>
              <li>N√£o substitui acompanhamento profissional individual.</li>
              <li>Reprodu√ß√µes e distribui√ß√£o n√£o autorizadas s√£o proibidas.</li>
            </ul>
            <p class="legal-note">
              Este mini app √© para reflex√£o, orienta√ß√£o e redu√ß√£o de danos, n√£o para diagn√≥stico ou tratamento.
            </p>

            <div class="tabs" role="tablist" aria-label="Abas">
              <button class="tab-btn active" data-view="guide" role="tab" aria-selected="true" type="button">
                <span class="icon">üìñ</span>
                <span>Guia</span>
              </button>
              <button class="tab-btn crisis" data-view="crisis" role="tab" aria-selected="false" type="button">
                <span class="icon">üî•</span>
                <span>Crise agora</span>
              </button>
            </div>
          </div>
        </section>
      </header>

      <section class="app-body">
        <!-- GUIA -->
        <section class="view active" id="view-guide">
          <div class="layout-main">
            <section class="section-shell">

              <article class="section-page active" data-section="1">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">Boas-vindas</div>
                    <h2 class="section-title">Para quem √© este guia</h2>
                    <p class="section-subtitle">
                      Se voc√™ convive com algu√©m com borderline e sente que tudo vira crise, este espa√ßo foi feito para voc√™.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 1 de 8</div>
                </header>

                <div class="section-content">
                  <p>
                    Este guia √© para familiares, parceiros, amigos e pessoas pr√≥ximas que convivem com algu√©m com Transtorno de Personalidade Borderline (TPB) e se sentem exaustos, confusos ou culpados por n√£o saber como ajudar.
                  </p>

                  <ul class="bullet-list">
                    <li>Para quem convive com algu√©m com borderline.</li>
                    <li>Para quem j√° tentou ajudar e s√≥ piorou.</li>
                    <li>Para quem vive em alerta emocional.</li>
                    <li>Para quem sente culpa, exaust√£o e confus√£o.</li>
                  </ul>

                  <div class="info-card">
                    <span class="icon-circle icon-info">i</span>
                    <div>
                      <div class="mini-heading">Voc√™ n√£o est√° errando por mal.</div>
                      <p>
                        Muitas respostas s√£o bem-intencionadas, mas acabam intensificando a crise sem que voc√™ perceba.
                        Este guia existe para reduzir esse dano e oferecer um caminho mais claro.
                      </p>
                    </div>
                  </div>

                  <div class="pill-list">
                    <span class="pill">Entender o que acontece na crise</span>
                    <span class="pill">Saber o que dizer e o que evitar</span>
                    <span class="pill">Proteger sua sa√∫de emocional</span>
                  </div>
                </div>
              </article>

              <article class="section-page" data-section="2">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">Compreendendo a crise</div>
                    <h2 class="section-title">Por que tudo parece come√ßar ‚Äúdo nada‚Äù?</h2>
                    <p class="section-subtitle">
                      Pequenos gatilhos podem ativar rea√ß√µes emocionais muito intensas ‚Äî e isso n√£o √© drama.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 2 de 8</div>
                </header>

                <div class="section-content">
                  <div class="warning-card">
                    <span class="icon-circle icon-warning">!</span>
                    <div>
                      <div class="mini-heading">Em crise, o c√©rebro est√° em modo de amea√ßa.</div>
                      <p>
                        A emo√ß√£o sobe r√°pido. A l√≥gica chega atrasada. E ‚Äúexplicar‚Äù pode ser sentido como ataque.
                      </p>
                    </div>
                  </div>

                  <p>
                    Para quem est√° de fora, parece desproporcional. Para quem est√° em crise, parece sobreviv√™ncia emocional.
                  </p>

                  <p class="quote-block">
                    Emo√ß√£o alta primeiro. Interpreta√ß√£o depois. Conversa s√≥ quando baixar.
                  </p>
                </div>
              </article>

              <article class="section-page" data-section="3">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">O que piora</div>
                    <h2 class="section-title">Respostas autom√°ticas que inflam o conflito</h2>
                    <p class="section-subtitle">
                      Coisas ‚Äúracionais‚Äù podem ser recebidas como frieza, rejei√ß√£o ou amea√ßa.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 3 de 8</div>
                </header>

                <div class="section-content">
                  <ul class="bullet-list">
                    <li>Corrigir fatos no meio da explos√£o.</li>
                    <li>Mandar ‚Äúse acalmar‚Äù.</li>
                    <li>Minimizar (‚Äún√£o √© para tanto‚Äù).</li>
                    <li>Ironia e sarcasmo.</li>
                    <li>Exigir coer√™ncia na hora errada.</li>
                  </ul>

                  <p class="quote-block">
                    Em crise: menos conte√∫do, mais regula√ß√£o.
                  </p>
                </div>
              </article>

              <article class="section-page" data-section="4">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">Reconhecendo o in√≠cio</div>
                    <h2 class="section-title">Sinais de que a crise j√° come√ßou</h2>
                    <p class="section-subtitle">
                      O corpo costuma avisar antes da explos√£o completa.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 4 de 8</div>
                </header>

                <div class="section-content">
                  <ul class="bullet-list">
                    <li>Mudan√ßa s√∫bita de humor.</li>
                    <li>Irrita√ß√£o sem motivo claro.</li>
                    <li>Sil√™ncio tenso.</li>
                    <li>Choro repentino.</li>
                    <li>Impulsividade.</li>
                  </ul>

                  <p class="quote-block">
                    Intervir cedo evita escalada.
                  </p>
                </div>
              </article>

              <article class="section-page" data-section="5">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">Durante a crise</div>
                    <h2 class="section-title">Foco em regular a emo√ß√£o</h2>
                    <p class="section-subtitle">
                      Objetivo: baixar a ativa√ß√£o para depois conversar.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 5 de 8</div>
                </header>

                <div class="section-content">
                  <ul class="bullet-list">
                    <li>Tom de voz baixo e firme.</li>
                    <li>Frases curtas e claras.</li>
                    <li>Presen√ßa sem press√£o.</li>
                    <li>Reduzir est√≠mulos do ambiente.</li>
                  </ul>

                  <p class="quote-block">
                    Regular n√£o √© concordar: √© tornar poss√≠vel conversar.
                  </p>
                </div>
              </article>

              <article class="section-page" data-section="6">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">O que dizer</div>
                    <h2 class="section-title">Frases que organizam (e desorganizam)</h2>
                    <p class="section-subtitle">
                      Pequenas mudan√ßas de frase mudam o resultado.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 6 de 8</div>
                </header>

                <div class="section-content">
                  <div style="overflow-x:auto;">
                    <table style="width:100%; border-collapse:collapse; font-size:0.82rem; margin-top:6px;">
                      <thead>
                        <tr style="background:#f6eee5;">
                          <th style="padding:8px; border-bottom:1px solid #e0d4c4; text-align:left;">Desorganiza</th>
                          <th style="padding:8px; border-bottom:1px solid #e0d4c4; text-align:left;">Organiza</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúVoc√™ t√° exagerando.‚Äù</td>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúEu vejo que t√° pesado pra voc√™.‚Äù</td>
                        </tr>
                        <tr>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúDe novo isso?‚Äù</td>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúVamos baixar a emo√ß√£o e depois entender.‚Äù</td>
                        </tr>
                        <tr>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúSe controla.‚Äù</td>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúT√¥ aqui. Respira comigo.‚Äù</td>
                        </tr>
                        <tr>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúIsso √© drama.‚Äù</td>
                          <td style="padding:8px; border-bottom:1px solid #f0e6d6;">‚ÄúIsso √© sinal de sofrimento.‚Äù</td>
                        </tr>
                        <tr>
                          <td style="padding:8px;">‚ÄúVoc√™ complica tudo.‚Äù</td>
                          <td style="padding:8px;">‚ÄúVamos simplificar juntos.‚Äù</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <div class="success-card">
                    <span class="icon-circle icon-success">‚úì</span>
                    <div>
                      <div class="mini-heading">Se a pessoa pedir espa√ßo</div>
                      <p>
                        Afastamento pode ser tentativa de reduzir sobrecarga. Combine uma comunica√ß√£o m√≠nima.
                      </p>
                      <p class="quote-block">
                        ‚ÄúPode ir. S√≥ me avisa quando estiver bem pra falar.‚Äù
                      </p>
                    </div>
                  </div>
                </div>
              </article>

              <article class="section-page" data-section="7">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">Depois da crise</div>
                    <h2 class="section-title">Reconectar, revisar e colocar limites</h2>
                    <p class="section-subtitle">
                      Limite n√£o √© abandono: √© previsibilidade.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 7 de 8</div>
                </header>

                <div class="section-content">
                  <p><strong>Evite:</strong> reabrir tudo, repassar cada detalhe, ‚Äúdar aula‚Äù no outro.</p>
                  <p><strong>Fa√ßa:</strong> validar, alinhar 1 limite claro, combinar o pr√≥ximo passo.</p>

                  <p class="quote-block">
                    ‚ÄúEu fico com voc√™. Mas eu n√£o continuo se houver gritos.‚Äù
                  </p>
                </div>
              </article>

              <article class="section-page" data-section="8">
                <header class="section-header">
                  <div>
                    <div class="section-kicker">Preven√ß√£o e ajuda</div>
                    <h2 class="section-title">Preven√ß√£o di√°ria, buscar ajuda e mensagem final</h2>
                    <p class="section-subtitle">
                      Pequenos ajustes di√°rios mudam o ciclo.
                    </p>
                  </div>
                  <div class="badge-compact">Passo 8 de 8</div>
                </header>

                <div class="section-content">
                  <ul class="bullet-list">
                    <li>Comunica√ß√£o clara (sem indireta/sarcasmo).</li>
                    <li>Avisar mudan√ßas com anteced√™ncia quando poss√≠vel.</li>
                    <li>Validar antes de discordar.</li>
                    <li>Cuidar de quem cuida.</li>
                  </ul>

                  <p class="quote-block">
                    Voc√™ n√£o precisa acertar sempre. Precisa saber quando agir, quando pausar e quando pedir ajuda.
                  </p>
                </div>
              </article>
            </section>

            <aside class="side-panel">
              <section class="pill-section-nav">
                <div class="pill-section-nav-title">Navegue pelo conte√∫do</div>
                <div class="pill-section-nav-items">
                  <button class="nav-chip active" data-go="1" type="button">Boas-vindas</button>
                  <button class="nav-chip" data-go="2" type="button">‚ÄúDo nada‚Äù</button>
                  <button class="nav-chip" data-go="3" type="button">O que piora</button>
                  <button class="nav-chip" data-go="4" type="button">Sinais</button>
                  <button class="nav-chip" data-go="5" type="button">Durante</button>
                  <button class="nav-chip" data-go="6" type="button">Frases</button>
                  <button class="nav-chip" data-go="7" type="button">Depois</button>
                  <button class="nav-chip" data-go="8" type="button">Preven√ß√£o</button>
                </div>
              </section>

              <section class="cta-card">
                <div class="cta-tag">Como usar</div>
                <div class="cta-title">Use este guia como mapa, n√£o como regra r√≠gida</div>
                <p>
                  Leia com calma e volte ao trecho que fizer sentido. Combine este material com suporte do seu profissional de confian√ßa.
                </p>
                <p class="cta-note">
                  Na aba ‚ÄúCrise agora‚Äù, registre crises no seu dispositivo (privado) e leve o hist√≥rico para acompanhamento.
                </p>
              </section>

              <section class="ref-card">
                <div class="mini-heading">Refer√™ncias (sele√ß√£o)</div>
                <ul>
                  <li>American Psychiatric Association. DSM-5.</li>
                  <li>Linehan MM. DBT Skills Training Manual.</li>
                  <li>Bateman A, Fonagy P. MBT for BPD.</li>
                </ul>
              </section>

              <section class="progress-bar-wrapper">
                <div class="progress-label-row">
                  <span>Progresso no guia</span>
                  <span id="progress-text">1 de 8</span>
                </div>
                <div class="progress-track">
                  <div class="progress-fill" id="progress-bar"></div>
                </div>
              </section>
            </aside>
          </div>

          <footer class="nav-controls" aria-label="Controles de navega√ß√£o">
            <div class="stepper-indicator" aria-hidden="true">
              <span class="step-dot active"></span>
              <span class="step-dot"></span>
              <span class="step-dot"></span>
              <span class="step-dot"></span>
              <span class="step-dot"></span>
              <span class="step-dot"></span>
              <span class="step-dot"></span>
              <span class="step-dot"></span>
            </div>

            <div class="nav-buttons">
              <button class="nav-btn" id="prev-btn" disabled type="button">‚Üê Voltar</button>
              <button class="nav-btn primary" id="next-btn" type="button">Pr√≥ximo passo ‚Üí</button>
            </div>

            <div class="nav-caption">Use os bot√µes ou os chips laterais para navegar.</div>
          </footer>
        </section>

        <!-- CRISE -->
        <section class="view" id="view-crisis">
          <section class="crisis-wrapper">
            <header class="crisis-header">
              <div class="crisis-kicker">Crise agora</div>
              <h2 class="crisis-title">Escolha a intensidade e siga o passo a passo</h2>
              <p class="crisis-subtitle">
                N√£o √© sobre julgar a crise, √© sobre reduzir danos e escolher a conduta mais adequada agora.
              </p>
            </header>

            <section>
              <div class="crisis-intensity-grid" id="crisis-levels"></div>

              <div class="crisis-panel" id="crisis-panel">
                <div class="crisis-panel-title">
                  <span id="crisis-panel-title-text">Comece escolhendo a intensidade da crise.</span>
                </div>
                <p class="crisis-note">
                  Ao escolher um n√≠vel, voc√™ ver√° orienta√ß√µes e poder√° registrar a crise de forma privada neste dispositivo.
                </p>
              </div>
            </section>

            <section class="history-box" aria-label="Hist√≥rico de crises">
              <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
                <span class="mini-heading">Hist√≥rico recente de crises</span>
                <button class="btn-small" id="clear-history-btn" type="button">Limpar hist√≥rico</button>
              </div>
              <div class="history-list" id="history-list">
                <div class="history-entry-body">
                  Nenhuma crise registrada ainda. Quando voc√™ registrar, elas aparecer√£o aqui (privado neste navegador).
                </div>
              </div>
            </section>

            <section class="history-box" aria-label="Relat√≥rio para acompanhamento">
              <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
                <span class="mini-heading">Relat√≥rio para levar ao seu profissional</span>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <button class="btn-small" id="generate-report-btn" type="button">Gerar relat√≥rio</button>
                  <button class="btn-small" id="copy-report-btn" type="button">Copiar</button>
                </div>
              </div>
              <p class="crisis-note">
                O texto abaixo resume crises registradas neste dispositivo. Voc√™ pode copiar e colar.
              </p>
              <div class="report-output" id="report-output"></div>
            </section>
          </section>
        </section>
      </section>
    </main>
  </div>

<script>
  const appConfig = {
    history: {
      storageKey: "borderline_crisis_history_v1",
      maxEntries: 150
    },
    crisisLevels: [
      {
        id: "leve",
        label: "Leve",
        chip: "Desconforto control√°vel",
        description: "Ansiedade, irrita√ß√£o ou tristeza, mas ainda √© poss√≠vel organizar o m√≠nimo.",
        mode: "breathing"
      },
      {
        id: "moderada",
        label: "Moderada",
        chip: "Emo√ß√£o muito alta",
        description: "Choro, impulsividade, vontade de discutir; sem risco imediato √† seguran√ßa.",
        mode: "checklist"
      },
      {
        id: "grave",
        label: "Grave",
        chip: "Risco √† seguran√ßa",
        description: "Sinais de risco importante. Prioridade: seguran√ßa e ajuda imediata.",
        mode: "emergency"
      }
    ]
  };

  /* -------------------------
     GUIA: navega√ß√£o + progresso
  -------------------------- */
  (function initGuide() {
    const totalSections = 8;
    let current = 1;

    const pages = document.querySelectorAll('.section-page');
    const chips = document.querySelectorAll('.nav-chip');
    const dots = document.querySelectorAll('.step-dot');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    function updateGuideView(target) {
      current = target;

      pages.forEach(page => {
        const sec = Number(page.getAttribute('data-section'));
        page.classList.toggle('active', sec === current);
      });

      chips.forEach(chip => {
        const sec = Number(chip.getAttribute('data-go'));
        chip.classList.toggle('active', sec === current);
      });

      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index + 1 === current);
      });

      const pct = (current / totalSections) * 100;
      progressBar.style.width = pct + '%';
      progressText.textContent = current + ' de ' + totalSections;

      prevBtn.disabled = current === 1;
      nextBtn.disabled = current === totalSections;
      nextBtn.textContent = current === totalSections ? 'Conclu√≠do' : 'Pr√≥ximo passo ‚Üí';

      try { localStorage.setItem('borderline_guide_last_section', String(current)); } catch(e) {}
    }

    prevBtn.addEventListener('click', () => { if (current > 1) updateGuideView(current - 1); });
    nextBtn.addEventListener('click', () => { if (current < totalSections) updateGuideView(current + 1); });

    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        const sec = Number(chip.getAttribute('data-go'));
        updateGuideView(sec);
      });
    });

    try {
      const saved = localStorage.getItem('borderline_guide_last_section');
      if (saved) {
        const sec = Number(saved);
        if (sec >= 1 && sec <= totalSections) updateGuideView(sec);
        else updateGuideView(1);
      } else {
        updateGuideView(1);
      }
    } catch(e) {
      updateGuideView(1);
    }
  })();

  /* -------------------------
     ABAS: Guia / Crise agora
  -------------------------- */
  (function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const viewGuide = document.getElementById('view-guide');
    const viewCrisis = document.getElementById('view-crisis');

    function setView(view) {
      const guideActive = view === 'guide';
      viewGuide.classList.toggle('active', guideActive);
      viewCrisis.classList.toggle('active', !guideActive);

      tabButtons.forEach(btn => {
        const target = btn.getAttribute('data-view');
        const isActive = target === view;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
      });
    }

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => setView(btn.getAttribute('data-view')));
    });

    setView('guide');
    window.__setView = setView; // √∫til se quiser chamar via console
  })();

  /* -------------------------
     HIST√ìRICO (LocalStorage)
  -------------------------- */
  function loadHistory() {
    try {
      const raw = localStorage.getItem(appConfig.history.storageKey);
      if (!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    } catch(e) {
      return [];
    }
  }

  function saveHistory(entries) {
    const trimmed = entries.slice(-appConfig.history.maxEntries);
    try { localStorage.setItem(appConfig.history.storageKey, JSON.stringify(trimmed)); } catch(e) {}
    return trimmed;
  }

  function addCrisisEntry(entry) {
    const history = loadHistory();
    history.push(entry);
    saveHistory(history);
    renderHistory();
  }

  function formatDateTime(iso) {
    const d = new Date(iso);
    if (Number.isNaN(d.getTime())) return iso;
    return d.toLocaleString('pt-BR', {
      day: '2-digit', month: '2-digit', year: 'numeric',
      hour: '2-digit', minute: '2-digit'
    });
  }

  function generateReportText() {
    const history = loadHistory();
    if (!history.length) return 'Nenhuma crise registrada at√© o momento neste dispositivo.';

    const lines = history.map(h => {
      const dt = formatDateTime(h.timestamp);
      const level = h.level || 'n√£o informado';
      const trigger = h.perceivedTrigger || 'n√£o informado';
      const actions = (h.actionsTaken && h.actionsTaken.length) ? h.actionsTaken.join(', ') : 'n√£o informado';
      const urgent = h.calledEmergency ? 'SIM' : 'N√ÉO';
      const notes = h.notes || 'sem observa√ß√µes';

      return (
        `Data/Hora: ${dt}\n` +
        `Intensidade: ${level}\n` +
        `Gatilho percebido: ${trigger}\n` +
        `A√ß√µes realizadas: ${actions}\n` +
        `Buscou ajuda urgente: ${urgent}\n` +
        `Observa√ß√µes: ${notes}\n` +
        `---`
      );
    });

    return lines.join('\n');
  }

  function renderHistory() {
    const list = document.getElementById('history-list');
    if (!list) return;

    const history = loadHistory();
    list.innerHTML = '';

    if (!history.length) {
      const div = document.createElement('div');
      div.className = 'history-entry-body';
      div.textContent = 'Nenhuma crise registrada ainda. Quando voc√™ registrar, elas aparecer√£o aqui (privado neste navegador).';
      list.appendChild(div);
      return;
    }

    history.slice().reverse().forEach(h => {
      const wrapper = document.createElement('div');
      wrapper.className = 'history-entry';

      const header = document.createElement('div');
      header.className = 'history-entry-header';

      const levelSpan = document.createElement('span');
      levelSpan.className = 'history-entry-level badge-level-' + (h.level || '');
      const lvl = (h.level || '‚Äî');
      levelSpan.textContent = lvl.charAt(0).toUpperCase() + lvl.slice(1);

      const timeSpan = document.createElement('span');
      timeSpan.textContent = formatDateTime(h.timestamp);

      header.appendChild(levelSpan);
      header.appendChild(timeSpan);

      const body = document.createElement('div');
      body.className = 'history-entry-body';
      body.textContent = h.perceivedTrigger ? ('Gatilho: ' + h.perceivedTrigger) : 'Gatilho n√£o informado.';

      wrapper.appendChild(header);
      wrapper.appendChild(body);
      list.appendChild(wrapper);
    });
  }

  function wireReportButtons() {
    const generateBtn = document.getElementById('generate-report-btn');
    const copyBtn = document.getElementById('copy-report-btn');
    const output = document.getElementById('report-output');

    if (generateBtn && output) {
      generateBtn.addEventListener('click', () => {
        output.textContent = generateReportText();
      });
    }

    if (copyBtn && output) {
      copyBtn.addEventListener('click', async () => {
        const txt = output.textContent || '';
        if (!txt) return;
        try {
          await navigator.clipboard.writeText(txt);
          copyBtn.textContent = 'Copiado ‚úì';
          setTimeout(() => (copyBtn.textContent = 'Copiar'), 1200);
        } catch(e) {
          // fallback simples
          const ta = document.createElement('textarea');
          ta.value = txt;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
          copyBtn.textContent = 'Copiado ‚úì';
          setTimeout(() => (copyBtn.textContent = 'Copiar'), 1200);
        }
      });
    }
  }

  function wireClearHistory() {
    const btn = document.getElementById('clear-history-btn');
    const output = document.getElementById('report-output');
    if (!btn) return;

    btn.addEventListener('click', () => {
      try { localStorage.removeItem(appConfig.history.storageKey); } catch(e) {}
      renderHistory();
      if (output) output.textContent = '';
    });
  }

  /* -------------------------
     CRISE: UI + modos + registro
  -------------------------- */
  (function initCrisis() {
    const levelsContainer = document.getElementById('crisis-levels');
    const panel = document.getElementById('crisis-panel');

    if (!levelsContainer || !panel) return;

    let breathingTimer = null;

    function stopBreathingTimer() {
      if (breathingTimer) {
        clearInterval(breathingTimer);
        breathingTimer = null;
      }
    }

    function renderLevels() {
      levelsContainer.innerHTML = '';
      appConfig.crisisLevels.forEach(level => {
        const card = document.createElement('div');
        card.className = 'crisis-intensity-card';
        card.dataset.levelId = level.id;

        const labelRow = document.createElement('div');
        labelRow.className = 'crisis-intensity-label';

        const labelSpan = document.createElement('span');
        labelSpan.textContent = level.label;

        const chip = document.createElement('span');
        chip.className = 'crisis-chip';
        chip.textContent = level.chip;

        labelRow.appendChild(labelSpan);
        labelRow.appendChild(chip);

        const desc = document.createElement('div');
        desc.className = 'crisis-intensity-desc';
        desc.textContent = level.description;

        card.appendChild(labelRow);
        card.appendChild(desc);

        card.addEventListener('click', () => {
          document.querySelectorAll('.crisis-intensity-card').forEach(c => c.classList.remove('active'));
          card.classList.add('active');
          showMode(level);
        });

        levelsContainer.appendChild(card);
      });
    }

    function showMode(level) {
      stopBreathingTimer();
      panel.innerHTML = '';

      const titleDiv = document.createElement('div');
      titleDiv.className = 'crisis-panel-title';

      const mainText = document.createElement('span');
      mainText.textContent = level.chip;

      const modeLabel = document.createElement('span');
      modeLabel.className = 'crisis-mode-label';
      modeLabel.textContent = 'Intensidade: ' + level.label;

      titleDiv.appendChild(mainText);
      titleDiv.appendChild(modeLabel);
      panel.appendChild(titleDiv);

      if (level.mode === 'breathing') renderBreathingMode(panel, level);
      if (level.mode === 'checklist') renderChecklistMode(panel, level);
      if (level.mode === 'emergency') renderEmergencyMode(panel, level);
    }

    function baseForm(level) {
      const form = document.createElement('div');
      form.className = 'crisis-form';

      const label1 = document.createElement('label');
      label1.textContent = 'Gatilho percebido (opcional)';

      const trigger = document.createElement('input');
      trigger.type = 'text';
      trigger.placeholder = 'Ex.: sil√™ncio, atraso, tom de voz, cr√≠tica, ci√∫me, inseguran√ßa...';

      const label2 = document.createElement('label');
      label2.textContent = 'Observa√ß√µes (opcional)';

      const notes = document.createElement('textarea');
      notes.placeholder = 'O que voc√™ viu / ouviu? O que ajudou a baixar 1 grau?';

      form.appendChild(label1);
      form.appendChild(trigger);
      form.appendChild(label2);
      form.appendChild(notes);

      const actionsLabel = document.createElement('label');
      actionsLabel.textContent = 'A√ß√µes realizadas (marque o que voc√™ fez)';

      const actionsWrap = document.createElement('div');
      actionsWrap.className = 'checklist';

      const actionItems = [
        'Falei mais baixo e devagar',
        'Reduzi est√≠mulos (barulho, pessoas, discuss√£o)',
        'Usei frases curtas e objetivas',
        'Validei sem discutir o conte√∫do',
        'Dei espa√ßo com combinado m√≠nimo',
        'Propus pausa e retomada depois'
      ];

      const checkboxes = [];

      actionItems.forEach(txt => {
        const row = document.createElement('label');
        row.className = 'checklist-item';

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.value = txt;
        checkboxes.push(cb);

        const span = document.createElement('span');
        span.textContent = txt;

        row.appendChild(cb);
        row.appendChild(span);
        actionsWrap.appendChild(row);
      });

      form.appendChild(actionsLabel);
      form.appendChild(actionsWrap);

      // bot√£o registrar
      const actionsRow = document.createElement('div');
      actionsRow.className = 'crisis-actions-row';

      const saveBtn = document.createElement('button');
      saveBtn.className = 'btn-small primary';
      saveBtn.type = 'button';
      saveBtn.textContent = 'Registrar crise';

      const resetBtn = document.createElement('button');
      resetBtn.className = 'btn-small';
      resetBtn.type = 'button';
      resetBtn.textContent = 'Limpar campos';

      actionsRow.appendChild(saveBtn);
      actionsRow.appendChild(resetBtn);

      form.appendChild(actionsRow);

      resetBtn.addEventListener('click', () => {
        trigger.value = '';
        notes.value = '';
        checkboxes.forEach(cb => cb.checked = false);
      });

      return { form, trigger, notes, checkboxes, saveBtn };
    }

    function renderBreathingMode(container, level) {
      const p = document.createElement('p');
      p.textContent = 'Primeiro objetivo: baixar a emo√ß√£o 1‚Äì2 graus. Fa√ßa 60‚Äì90 segundos de respira√ß√£o guiada, sem discutir conte√∫do.';
      container.appendChild(p);

      const b = document.createElement('div');
      b.className = 'breathing-container';

      const circle = document.createElement('div');
      circle.className = 'breathing-circle';
      circle.textContent = 'Inspire (4)‚Ä¶';

      const caption = document.createElement('div');
      caption.className = 'breathing-caption';
      caption.textContent = 'Ritmo: inspire 4s ‚Ä¢ segure 2s ‚Ä¢ expire 6s ‚Ä¢ segure 2s. Repita 4 vezes.';

      b.appendChild(circle);
      b.appendChild(caption);
      container.appendChild(b);

      const phases = [
        { text: 'Inspire (4)‚Ä¶', ms: 4000 },
        { text: 'Segure (2)‚Ä¶', ms: 2000 },
        { text: 'Expire (6)‚Ä¶', ms: 6000 },
        { text: 'Segure (2)‚Ä¶', ms: 2000 },
      ];

      let idx = 0;
      let phaseStart = Date.now();

      function tick() {
        const now = Date.now();
        const elapsed = now - phaseStart;
        const currentPhase = phases[idx];

        if (elapsed >= currentPhase.ms) {
          idx = (idx + 1) % phases.length;
          phaseStart = now;
          circle.textContent = phases[idx].text;
        }
      }

      // in√≠cio
      circle.textContent = phases[0].text;
      breathingTimer = setInterval(tick, 200);

      const formBits = baseForm(level);
      container.appendChild(formBits.form);

      formBits.saveBtn.addEventListener('click', () => {
        const actionsTaken = formBits.checkboxes.filter(cb => cb.checked).map(cb => cb.value);
        addCrisisEntry({
          timestamp: new Date().toISOString(),
          level: level.id,
          perceivedTrigger: (formBits.trigger.value || '').trim(),
          notes: (formBits.notes.value || '').trim(),
          actionsTaken,
          calledEmergency: false
        });
        formBits.saveBtn.textContent = 'Registrado ‚úì';
        setTimeout(() => (formBits.saveBtn.textContent = 'Registrar crise'), 1200);
      });
    }

    function renderChecklistMode(container, level) {
      const p = document.createElement('p');
      p.innerHTML = '<strong>Regra:</strong> reduzir atrito agora; conversar sobre ‚Äúo que aconteceu‚Äù s√≥ depois. Use frases curtas e tom baixo.';
      container.appendChild(p);

      const checklist = document.createElement('div');
      checklist.className = 'checklist';

      const items = [
        'Pausar a discuss√£o por 10‚Äì20 minutos (sem amea√ßa).',
        'Validar a emo√ß√£o: ‚ÄúEu entendo que isso doeu.‚Äù',
        'Fazer 1 pergunta concreta: ‚ÄúVoc√™ precisa de presen√ßa ou de espa√ßo?‚Äù',
        'Evitar explicar demais / dar aula / corrigir.',
        'Se necess√°rio, mudar de ambiente e reduzir est√≠mulos.'
      ];

      items.forEach(txt => {
        const row = document.createElement('div');
        row.className = 'checklist-item';
        const dot = document.createElement('span');
        dot.textContent = '‚Ä¢';
        const span = document.createElement('span');
        span.textContent = txt;
        row.appendChild(dot);
        row.appendChild(span);
        checklist.appendChild(row);
      });

      container.appendChild(checklist);

      const formBits = baseForm(level);
      container.appendChild(formBits.form);

      formBits.saveBtn.addEventListener('click', () => {
        const actionsTaken = formBits.checkboxes.filter(cb => cb.checked).map(cb => cb.value);
        addCrisisEntry({
          timestamp: new Date().toISOString(),
          level: level.id,
          perceivedTrigger: (formBits.trigger.value || '').trim(),
          notes: (formBits.notes.value || '').trim(),
          actionsTaken,
          calledEmergency: false
        });
        formBits.saveBtn.textContent = 'Registrado ‚úì';
        setTimeout(() => (formBits.saveBtn.textContent = 'Registrar crise'), 1200);
      });
    }

    function renderEmergencyMode(container, level) {
      const box = document.createElement('div');
      box.className = 'emergency-box';

      const title = document.createElement('div');
      title.className = 'emergency-title';
      title.innerHTML = '‚ö†Ô∏è Prioridade: seguran√ßa <span class="emergency-badge">a√ß√£o imediata</span>';

      const txt = document.createElement('div');
      txt.innerHTML =
        '<p style="margin:0;">Se h√° risco importante √† integridade, a prioridade √© <strong>proteger</strong> e <strong>buscar ajuda imediata</strong>. N√£o discuta conte√∫do, n√£o negocie na intensidade m√°xima.</p>' +
        '<ul style="margin:6px 0 0; padding-left:18px;">' +
        '<li>Reduza est√≠mulos e mantenha voz baixa e firme.</li>' +
        '<li>Garanta presen√ßa e supervis√£o (n√£o deixar a pessoa sozinha se houver risco).</li>' +
        '<li>Acione suporte urgente/local quando necess√°rio.</li>' +
        '</ul>';

      box.appendChild(title);
      box.appendChild(txt);
      container.appendChild(box);

      const formBits = baseForm(level);

      // campo extra: buscou ajuda urgente?
      const emergencyRow = document.createElement('label');
      emergencyRow.className = 'checklist-item';
      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.id = 'called-emergency';
      const sp = document.createElement('span');
      sp.textContent = 'Marcar se foi necess√°rio buscar ajuda urgente (servi√ßo local / emerg√™ncia / suporte imediato).';
      emergencyRow.appendChild(cb);
      emergencyRow.appendChild(sp);

      formBits.form.insertBefore(emergencyRow, formBits.form.lastChild);

      container.appendChild(formBits.form);

      formBits.saveBtn.addEventListener('click', () => {
        const actionsTaken = formBits.checkboxes.filter(c => c.checked).map(c => c.value);
        addCrisisEntry({
          timestamp: new Date().toISOString(),
          level: level.id,
          perceivedTrigger: (formBits.trigger.value || '').trim(),
          notes: (formBits.notes.value || '').trim(),
          actionsTaken,
          calledEmergency: cb.checked
        });
        formBits.saveBtn.textContent = 'Registrado ‚úì';
        setTimeout(() => (formBits.saveBtn.textContent = 'Registrar crise'), 1200);
      });
    }

    renderLevels();
    renderHistory();
    wireClearHistory();
    wireReportButtons();

    // gera relat√≥rio inicial vazio
    const reportOutput = document.getElementById('report-output');
    if (reportOutput) reportOutput.textContent = '';
  })();

  // render history no load (seguran√ßa)
  document.addEventListener('DOMContentLoaded', () => {
    renderHistory();
  });
</script>
</body>
</html>
